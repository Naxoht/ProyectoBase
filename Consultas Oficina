--1--
CREATE OR REPLACE PROCEDURE  consulta_oficina_codi (CODI OFFICE.CODE_OFFICE%TYPE)
AS

OFFI OFFICE%ROWTYPE;

BEGIN

SELECT * INTO OFFI FROM OFFICE O
WHERE CODI = O.CODE_OFFICE;

DBMS_OUTPUT.PUT_LINE('CODIGO OFICINA: '||OFFI.CODE_OFFICE||' CIUDAD: '||OFFI.CITY||' PROVINCIA: '||OFFI.PROVINCE||' OBJETIVO OFFICINA: '||OFFI.OFFICE_OBJECTIVE||' VENTAS OFICINA: '||OFFI.OFFICE_SALES||' DIRECTOR: '||OFFI.OFFICE_DIRECTOR);
END;

--SET SERVEROUTPUT ON;
--
--BEGIN
--
--consulta_oficina_codi('OFCO1');
--END;

--2--
CREATE OR REPLACE PROCEDURE CONSULTA_OFICINES
AS
    DIFERENCIA NUMBER;
    CURSOR EX2 IS
    SELECT * FROM OFFICE ORDER BY CODE_OFFICE ASC;
BEGIN
    DBMS_OUTPUT.PUT_LINE('OFICINA       DIFERENCIA');
    FOR I IN EX2 LOOP
         DIFERENCIA := I.OFFICE_OBJECTIVE-I.OFFICE_SALES;
        DBMS_OUTPUT.PUT_LINE (I.CODE_OFFICE||'         '||DIFERENCIA);
    END LOOP;

END;

--LLAMAR A LA FUNCION--
SET SERVEROUTPUT ON;

BEGIN
CONSULTA_OFICINES;
END;
--3--
CREATE OR REPLACE PROCEDURE CONSULTA_OFICINA_OBJECTIUS (OBJETIVO OFFICE.CODE_OFFICE%TYPE)
AS

CURSOR EX3 
IS
SELECT * FROM OFFICE
WHERE OFFICE.OFFICE_OBJECTIVE >= OBJETIVO;

BEGIN

FOR I IN EX3 LOOP
    IF OBJETIVO > 0 THEN
        DBMS_OUTPUT.PUT_LINE('CODIGO OFICINA: '||I.CODE_OFFICE||' CIUDAD: '||I.CITY||' PROVINCIA: '||I.PROVINCE||' OBJETIVO OFFICINA: '||I.OFFICE_OBJECTIVE||' VENTAS OFICINA: '||I.OFFICE_SALES||' DIRECTOR: '||I.OFFICE_DIRECTOR);
    ELSE
        DBMS_OUTPUT.PUT_LINE('INTRODUCE UN VALOR POSITIVO');
    END IF;
END LOOP;
END;

SET SERVEROUTPUT ON;
DECLARE

OBJETIVO NUMBER := &OBJETIVO;

BEGIN

CONSULTA_OFICINA_OBJECTIUS(OBJETIVO);

END;

--4--
CREATE OR REPLACE PROCEDURE CONSULTA_OFICINES_CAP(DIRECTOR NUMBER)
AS

CURSOR EX4 IS
SELECT * FROM OFFICE O
WHERE DIRECTOR = O.OFFICE_DIRECTOR;

DIRECT_CONT NUMBER;

BEGIN
DBMS_OUTPUT.PUT_LINE('OFICINA      DIRECTOR');
SELECT COUNT(OFFICE_DIRECTOR)INTO DIRECT_CONT FROM OFFICE O
WHERE O.OFFICE_DIRECTOR = DIRECTOR;
FOR I IN EX4 LOOP
    IF  DIRECT_CONT > 0 THEN
        DBMS_OUTPUT.PUT_LINE(I.CODE_OFFICE||'        '||I.OFFICE_DIRECTOR);
    END IF;    
END LOOP;
END;

SET SERVEROUTPUT ON;
DECLARE 
DIRECTOR NUMBER := &DIRECTOR;

BEGIN

CONSULTA_OFICINES_CAP(DIRECTOR);
END;
