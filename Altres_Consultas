--1--
/*Número comandes : s’ha de retornar quantes comandes han estat donades d’alta 
a la base de dades entre una data i una altra. Els rangs de dates estaran 
introduïts per teclat per part de l’usuari. Tractar tots els errors necessaris.*/

create or replace function numero_comandes (data1 date, data2 date) return number as

quantitat number := 0;
cursor datacomanda is
select * from order2;
begin
for i in datacomanda loop
    if i.order_date between data1 and data2 then
        quantitat := quantitat+1;
    end if;
end loop;
return quantitat;
end;


set serveroutput on;
declare
fecha1 date := &PrimeraFecha;
fecha2 date := &SegundaFecha;
vuelta number(30);
begin
vuelta := numero_comandes(fecha1, fecha2);
DBMS_OUTPUT.PUT_LINE(vuelta);
end;


--2--
--IMPORT TOTAL COMANDES--

create or replace function import_total_comanda (data1 date, data2 date) return number as

quantitat number := 0;
cursor comanda is
select * from order2;
NO_HAY_IMPORTE EXCEPTION;

begin
for i in comanda loop
    if i.order_date between data1 and data2 then
        quantitat := quantitat+i.total_amount;
    end if;
end loop;
    if quantitat <= 0 then
        raise NO_HAY_IMPORTE;
    end if;
return quantitat;

EXCEPTION
    WHEN NO_HAY_IMPORTE THEN
        DBMS_OUTPUT.PUT_LINE('NO HAY UN IMPORTE EN ESE RANGO!!!');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('ERROR, ALGO NO ANDA BIEN!!!');
end;


set serveroutput on;
declare
    fecha1 date := &PrimeraFecha;
    fecha2 date := &SegundaFecha;
    vuelta number(30);
begin
    vuelta := import_total_comanda(fecha1, fecha2);
    DBMS_OUTPUT.PUT_LINE(vuelta||'€');
end;


--3--
--NUMERO CLIENTS--
CREATE OR REPLACE PROCEDURE NUMERO_CLIENTS
AS

NO_HAY EXCEPTION;
CONT_CLIENTES NUMBER;

BEGIN

    SELECT COUNT(CUSTOMER_CODE) INTO CONT_CLIENTES FROM CUSTOMER;

    IF CONT_CLIENTES <= 0 THEN
        RAISE NO_HAY;
    ELSE 
        dbms_output.put_line('NUMERO DE CLIENTES: '||CONT_CLIENTES);
    END IF;
    
EXCEPTION
    WHEN NO_HAY THEN
        DBMS_OUTPUT.PUT_LINE('NO HAY CLIENTES!!!');
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('ERROR, ALGO NO SE HA REALIZADO CORRECTAMENTE!!!');
END;



--SET SERVEROUTPUT ON;
--
--BEGIN
--
--NUMERO_CLIENTS;
--END;
